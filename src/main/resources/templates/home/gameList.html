<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÃ³j Profil</title>
    <link id="favicon" rel="icon" type="image/svg+xml" href="/img/logo/logo-light.svg">
    <link rel="stylesheet" href="https://unpkg.com/cropperjs@1.5.13/dist/cropper.min.css">
    <script src="https://unpkg.com/cropperjs@1.5.13/dist/cropper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=League+Spartan:wght@100..900&display=swap');

        .font-league-spartan {
            font-family: 'League Spartan', sans-serif;
        }

        .font-jetbrains-mono {
            font-family: 'JetBrains Mono', monospace;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- Dodanie SweetAlert2 -->
    <script src="https://kit.fontawesome.com/0a5e3ca64c.js" crossorigin="anonymous"></script>
    <!-- Dodanie Font Awesome -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script> <!-- Dodanie Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> <!-- Dodanie Marked.js -->
    <script>// Ustawienia Tailwind CSS
    <script src="https://kit.fontawesome.com/0a5e3ca64c.js" crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>

        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        dark: {
                            background: "#1E1E1E",
                            backgroundSecondary: "#181818",
                            backgroundTertiary: "#101010",
                            textPrimary: "#E1E1E1",
                            textSecondary: "#AFAFAF",
                            accent: "#12e1b9",
                            border: "#333333",
                            surface: "#1E1E1E",
                            accentDark: "#00B189",
                            success: "#00EE00",
                            error: "#D00000",
                            warning: "#FF9831",
                        },
                        light: {
                            background: "#E1E1E1",
                            backgroundSecondary: "#C1C1C1",
                            backgroundTertiary: "#818181",
                            textPrimary: "#252525",
                            surface: "#F5F5F5",
                            border: "#CCCCCC",
                            textSecondary: "#505050",
                            accent: "#ED1E46",
                            accentDark: "#BD0016",
                            success: "#009688",
                            error: "#b388FF",
                            warning: "#FF6F00",
                        },
                    }
                }
            }
        };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=League+Spartan&display=swap');

        .font-league-spartan {
            font-family: 'League Spartan', sans-serif;
        }

        .font-jetbrains-mono {
            font-family: 'JetBrains Mono', monospace;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col bg-light-background dark:bg-dark-background font-league-spartan text-light-textPrimary dark:text-dark-textPrimary">
<nav class="flex justify-around w-full p-4 bg-light-surface dark:bg-dark-surface border-b border-light-border dark:border-dark-border z-20">
    <a href="/">
        <div class="flex items-center">
            <img id="logo-light" src="/img/logo/logo-light.svg" alt="RPG Manager" class="h-10 w-10 dark:hidden">
            <img id="logo-dark" src="/img/logo/logo-dark.svg" alt="RPG Manager" class="h-10 w-10 hidden dark:block">
            <h1 class="text-xl font-semibold ml-3 text-light-textPrimary dark:text-dark-textPrimary font-jetbrains-mono">
                RPG Handy Helper
            </h1>
        </div>
    </a>
    <div class="flex items-center justify-center">
        <i class="fa-solid fa-sun p-2 text-light-accent dark:text-dark-accent"></i>
        <div class="relative inline-block w-12 h-6">
            <input id="switch-component" type="checkbox" class="peer hidden m-1" />
            <label for="switch-component" class="absolute top-0.5 left-0.5 w-5 h-5 rounded-full
                       bg-light-accent dark:bg-dark-accent
                       shadow-md transition-all duration-300
                       peer-checked:translate-x-[0.75rem]
                       peer-checked:dark:bg-dark-accent peer-checked:bg-light-accent
                       cursor-pointer hover:shadow-lg">
            </label>
            <div class="w-12 h-6 rounded-full transition-all duration-300 cursor-pointer
                        bg-light-backgroundSecondary dark:bg-dark-backgroundSecondary">
            </div>
        </div>
        <i class="fa-solid fa-moon p-2 text-light-accent dark:text-dark-accent"></i>
    </div>
</nav>

<main class="flex-grow">
    <div class="flex flex-col items-center p-4 space-y-4 max-w-5xl mx-auto">
        <h2 class="text-3xl font-bold font-jetbrains-mono text-center text-light-textPrimary dark:text-dark-textPrimary">MOJE GRY</h2>

        <div class="flex flex-col md:flex-row md:justify-between w-full gap-2">
            <button id="createGameBtn" class="bg-light-accent dark:bg-dark-accent hover:bg-light-accentDark dark:hover:bg-dark-accentDark text-white px-6 py-2 rounded font-bold">
                UTWÃ“RZ NOWÄ„ GRÄ˜
            </button>
            <div class="flex items-center w-full md:w-auto">
                <input type="text" id="searchInput" placeholder="Wyszukaj" class="w-full md:w-64 px-4 py-2 rounded-l border border-gray-300 dark:border-gray-600 bg-white dark:bg-dark-surface text-black dark:text-dark-textPrimary" />
                <button id="searchBtn" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 rounded-r text-black dark:text-white">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>

        <div id="gamesContainer" class="flex flex-col gap-4 w-full"></div>
    </div>
</main>

<footer class="w-full text-center pt-2 pb-1 bg-light-surface dark:bg-dark-surface font-jetbrains-mono text-light-text dark:text-dark-text border-t border-light-border dark:border-dark-border z-20">
    <h3 class="text-light-textPrimary dark:text-dark-textPrimary">Z miÅ‚oÅ›ci do TTRPG ðŸ’™ Â© 2025 RPG Handy Helper</h3>
    <a href="/home/notes" class="text-light-accent dark:text-dark-accent"><i class="fa-brands fa-github"></i></a>
</footer>
</body>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const toggleSwitch = document.getElementById("switch-component");
        const body = document.body;
        const themeToggleDiv = document.querySelector(".flex.items-center.justify-center");
        const favicon = document.getElementById("favicon");
        function updateFavicon(theme) {
            if (favicon) {
                favicon.href = theme === "dark"
                    ? "/img/logo/logo-dark.svg"
                    : "/img/logo/logo-light.svg";
            }
        }
        function applyTheme(theme) {
            body.classList.toggle("dark", theme === "dark");
            localStorage.setItem("theme", theme);
            updateFavicon(theme);
            if (toggleSwitch) toggleSwitch.checked = (theme === "dark");
        }
        const savedTheme = localStorage.getItem("theme") || "dark";
        applyTheme(savedTheme);
        if (toggleSwitch) {
            toggleSwitch.addEventListener("change", function () {
                const newTheme = toggleSwitch.checked ? "dark" : "light";
                applyTheme(newTheme);
            });
        }
        if (themeToggleDiv) {
            themeToggleDiv.addEventListener("click", function (e) {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'LABEL') return;
                const newTheme = body.classList.contains("dark") ? "light" : "dark";
                applyTheme(newTheme);
            });
        }
    });

    document.addEventListener("DOMContentLoaded", async () => {
        const userRes = await fetch("/api/v1/authorized/user");
        const user = await userRes.json();
        const userId = user.id;

        const searchInput = document.getElementById("searchInput");
        const searchBtn = document.getElementById("searchBtn");
        const gamesContainer = document.getElementById("gamesContainer");

        async function loadGames(query = "") {
            const res = await fetch("/api/v1/authorized/game/userGames");
            const data = await res.json();
            const games = data.userGames || [];

            gamesContainer.innerHTML = "";

            const filteredGames = games.filter(g =>
                g.name.toLowerCase().includes(query.toLowerCase())
            );

            if (filteredGames.length === 0) {
                const message = query ? "Brak gier o podanej nazwie." :
                    "Nie naleÅ¼ysz jeszcze do Å¼adnych gier!<br>UtwÃ³rz swojÄ… pierwszÄ… grÄ™ juÅ¼ teraz.";
                gamesContainer.innerHTML = `<div class="bg-white dark:bg-dark-surface p-4 rounded shadow">${message}</div>`;
                return;
            }

            for (const game of filteredGames) {
                const playersRes = await fetch(`/api/v1/authorized/game/allPlayers/${game.id}`);
                const playersData = await playersRes.json();
                const players = playersData.gameUsers || [];

                const yourEntry = players.find(p => p.userId === userId);
                const role = yourEntry?.role || "Brak";
                const roleColor = role === "Player" ? "bg-orange-500" : role === "GameMaster" ? "bg-purple-400" : "bg-gray-400";
                const roleText = role || "Nieznana";

                gamesContainer.innerHTML += `
                    <a href="/game/${game.id}" class="block hover:shadow-lg transition-shadow duration-200">
                        <div class="bg-white dark:bg-dark-surface p-4 rounded shadow flex flex-col md:flex-row md:items-center md:justify-between">
                            <div>
                                <p class="text-sm text-red-700 font-semibold">${game.rpgSystemName}</p>
                                <h3 class="text-xl font-bold">${game.name}</h3>
                                <p class="text-gray-600 dark:text-gray-300">${game.description}</p>
                            </div>
                            <div class="mt-2 md:mt-0 md:text-right">
                                <p class="text-sm">Liczba graczy: <span class="font-bold">${players.length}</span></p>
                                <p class="text-sm">Twoja rola:</p>
                                <span class="text-white px-2 py-1 rounded ${roleColor}">${roleText}</span>
                            </div>
                        </div>
                    </a>
                `;
            }
        }

        searchBtn.addEventListener("click", () => {
            loadGames(searchInput.value);
        });

        searchInput.addEventListener("keypress", e => {
            if (e.key === "Enter") loadGames(searchInput.value);
        });

        loadGames();
    });
</script>
</html>