<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resetowanie hasła</title>

    <link id="favicon" rel="icon" type="image/svg+xml" href="/img/logo/logo-light.svg" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://kit.fontawesome.com/0a5e3ca64c.js" crossorigin="anonymous"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=League+Spartan:wght@100..900&display=swap');
        .font-league-spartan { font-family: 'League Spartan', sans-serif; }
        .font-jetbrains-mono { font-family: 'JetBrains Mono', monospace; }
    </style>

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        dark: {
                            background: "#1E1E1E",
                            surface: "#1E1E1E",
                            textPrimary: "#E1E1E1",
                            textSecondary: "#AFAFAF",
                            accent: "#12e1b9",
                            accentDark: "#00B189",
                            border: "#333333",
                        },
                        light: {
                            background: "#E1E1E1",
                            surface: "#F5F5F5",
                            textPrimary: "#252525",
                            textSecondary: "#505050",
                            accent: "#ED1E46",
                            accentDark: "#BD0016",
                            border: "#CCCCCC",
                        },
                    },
                },
            },
        };

        document.addEventListener("DOMContentLoaded", function () {
            const toggleSwitch = document.getElementById("switch-component");
            const body = document.body;
            const favicon = document.getElementById("favicon");

            function updateFavicon(theme) {
                if (favicon) {
                    favicon.href = theme === "dark"
                        ? "/img/logo/logo-dark.svg"
                        : "/img/logo/logo-light.svg";
                }
            }

            function applyTheme(theme) {
                body.classList.toggle("dark", theme === "dark");
                localStorage.setItem("theme", theme);
                updateFavicon(theme);
                if (toggleSwitch) toggleSwitch.checked = (theme === "dark");
            }

            const savedTheme = localStorage.getItem("theme") || "dark";
            applyTheme(savedTheme);

            if (toggleSwitch) {
                toggleSwitch.addEventListener("change", function () {
                    const newTheme = toggleSwitch.checked ? "dark" : "light";
                    applyTheme(newTheme);
                });
            }
        });

        const csrfToken = document.cookie.replace(/(?:(?:^|.*;\s*)XSRF-TOKEN\s*=\s*([^;]*).*$)|^.*$/, '$1');
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelector('#resetForm').addEventListener('submit', function (event) {
                event.preventDefault();
                const email = document.querySelector('#email').value;

                Swal.fire({
                    title: 'Proszę czekać...',
                    didOpen: () => Swal.showLoading(),
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                });

                fetch('/api/v1/forgotPassword/reset', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-XSRF-TOKEN': csrfToken
                    },
                    body: JSON.stringify({ email: email, _csrf: csrfToken })
                })
                    .then(response => response.json())
                    .then(data => {
                        Swal.close();
                        if (data.error === 200) {
                            Swal.fire({
                                title: 'Sukces!',
                                text: data.message,
                                icon: 'success',
                                confirmButtonText: 'OK'
                            }).then(result => {
                                if (result.isConfirmed) {
                                    window.location.href = '/login';
                                }
                            });
                        } else {
                            Swal.fire({
                                title: 'Błąd!',
                                text: data.message || 'Wystąpił nieznany błąd.',
                                icon: 'error',
                                confirmButtonText: 'OK'
                            });
                        }
                    })
                    .catch(error => {
                        Swal.close();
                        Swal.fire({
                            title: 'Błąd sieci!',
                            text: 'Nie udało się połączyć z serwerem.',
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                        console.error(error);
                    });
            });
        });
    </script>
</head>

<body class="min-h-screen flex flex-col font-league-spartan">

<div class="fixed top-4 right-4 z-50 flex items-center space-x-2">
    <i class="fa-solid fa-sun text-light-accent dark:text-dark-accent"></i>
    <label for="switch-component" class="relative inline-block w-12 h-6 cursor-pointer">
        <input id="switch-component" type="checkbox" class="peer hidden" />
        <div class="w-12 h-6 rounded-full transition-all duration-300 bg-light-backgroundSecondary dark:bg-dark-backgroundTertiary"></div>
        <div class="absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-light-accent dark:bg-dark-accent
                  shadow-md transition-all duration-300 peer-checked:translate-x-[1.5rem] pointer-events-none">
        </div>
    </label>
    <i class="fa-solid fa-moon text-light-accent dark:text-dark-accent"></i>
</div>

<main class="flex-grow flex flex-col items-center justify-center bg-light-background dark:bg-dark-background w-screen">
    <div class="p-4 m-3 text-3xl border-b-4 border-light-accentDark dark:border-dark-accentDark">
        <h1 class="font-semibold text-light-textPrimary dark:text-dark-textPrimary font-jetbrains-mono">RESETOWANIE HASŁA</h1>
    </div>

    <div class="flex flex-col items-center justify-center p-9 m-2 bg-light-surface dark:bg-dark-surface rounded-lg shadow-lg w-full max-w-xl">
        <form id="resetForm" class="flex flex-col items-center w-full">
            <div class="relative m-5 w-full">
                <input type="email" id="email" name="email" required autocomplete="off"
                       class="peer block rounded-t-lg px-2.5 pb-2.5 pt-5 w-full text-sm
                   text-light-textPrimary dark:text-dark-textPrimary
                   bg-light-background dark:bg-dark-background
                   border-0 border-b-2 border-light-border dark:border-dark-border
                   focus:outline-none focus:ring-0
                   focus:border-light-accent dark:focus:border-dark-accent placeholder-transparent" placeholder=" " />
                <label for="email"
                       class="absolute text-lg text-light-textSecondary dark:text-dark-textSecondary
                   duration-300 transform -translate-y-4 scale-90 top-4 z-10 origin-[0] start-2.5
                   peer-focus:text-light-accent peer-focus:dark:text-dark-accent
                   peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0
                   peer-focus:scale-90 peer-focus:-translate-y-4">
                    <i class="fa-solid fa-envelope mr-1"></i> Adres e-mail:
                </label>
            </div>

            <button type="submit"
                    class="px-[86px] py-3 text-lg font-semibold font-jetbrains-mono
                 dark:text-light-textPrimary text-dark-textPrimary
                 bg-light-accent dark:bg-dark-accent
                 border border-light-border dark:border-dark-border
                 rounded-lg transition-all duration-300
                 hover:bg-light-accentDark hover:dark:bg-dark-accentDark
                 focus:outline-none focus:ring-4 focus:ring-light-accent/50 dark:focus:ring-dark-accent/50
                 active:scale-95">
                Wyślij link resetujący
            </button>
        </form>

        <div class="flex flex-col items-center justify-center text-lg mt-4">
            <a href="/login" class="text-light-accent dark:text-dark-accent hover:underline">Powrót do logowania</a>
        </div>
    </div>
</main>

<footer class="w-full text-center p-4 bg-light-surface dark:bg-dark-surface font-jetbrains-mono text-light-textPrimary dark:text-dark-textPrimary border-t border-light-border dark:border-dark-border">
    <h3 class="text-light-textPrimary dark:text-dark-textPrimary">Od Graczy dla Graczy © 2025 RPG Handy Helper</h3>
    <a href="https://github.com/xEdziu/RPG-Handy-Helper" target="_blank" class="text-light-accent dark:text-dark-accent">
        <i class="fa-brands fa-github"></i>
    </a>
</footer>
</body>
</html>
